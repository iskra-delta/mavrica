ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 1.
Hexadecimal [24-Bits]



                                      1 		;; crt0.s
                                      2         ;; 
                                      3         ;; a minimal crt0.s startup code for Iskra Delta Partner program
                                      4         ;; 
                                      5         ;; TODO: 
                                      6         ;;  - handle cmd line
                                      7 		;;
                                      8         ;; MIT License (see: LICENSE)
                                      9         ;; copyright (c) 2022 tomaz stih
                                     10         ;;
                                     11 		;; 22.03.2022    tstih
                                     12 		.module crt0
                                     13 
                                     14        	.globl  _main
                                     15         .globl  _heap
                                     16 
                                     17 		.area 	_CODE
      000000                         18 start:
                                     19         ;; define a stack   
      000000 31 00 04         [10]   20         ld      sp,#stack
                                     21 
                                     22         ;; SDCC init globals
      000003 CD 00 00         [17]   23         call    gsinit
                                     24 
                                     25         ;; load argc and argv to stack for the main function
      000006 CD 00 00         [17]   26         call    pargs
      000009 21 00 00         [10]   27         ld      hl, #argv
      00000C E5               [11]   28         push    hl
      00000D 2A 00 00         [16]   29         ld      hl, (argc)
      000010 E5               [11]   30         push    hl
                                     31 
                                     32         ;; call the main
      000011 CD 00 00         [17]   33 	    call    _main
                                     34 
                                     35         ;; BDOS exit (reset) return control to CP/M.
      000014 0E 00            [ 7]   36         ld      c,#0
      000016 C3 05 00         [10]   37 	    jp      5
                                     38 
                                     39 		;; Ordering of segments for the linker (after header)
                                     40 		.area 	_CODE
                                     41         .area   _GSINIT
                                     42         .area   _GSFINAL	
                                     43         .area   _HOME
                                     44         .area   _INITIALIZER
                                     45         .area   _INITFINAL
                                     46         .area   _INITIALIZED
                                     47         .area   _DATA
                                     48         .area   _BSS
                                     49         .area	_STACK
                                     50         .area   _HEAP
                                     51 
                                     52 
                                     53         ;; init code for functions/var.
                                     54         .area   _GSINIT
      000000                         55 gsinit::      
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 2.
Hexadecimal [24-Bits]



                                     56         ;; copy statics.
      000000 01 00 00         [10]   57         ld      bc, #l__INITIALIZER
      000003 78               [ 4]   58         ld      a, b
      000004 B1               [ 4]   59         or      a, c
      000005 28 08            [12]   60         jr      Z, gsinit_done
      000007 11 00 00         [10]   61         ld      de, #s__INITIALIZED
      00000A 21 00 00         [10]   62         ld      hl, #s__INITIALIZER
      00000D ED B0            [21]   63         ldir
      00000F                         64 gsinit_done:
                                     65         .area   _GSFINAL
      000000 C9               [10]   66         ret
                                     67 
                                     68 
                                     69         .area	_STACK
      000000                         70 	    .ds	    1024
      000400                         71 stack:
                                     72 
                                     73 
                                     74         .area   _HEAP
      000000                         75 _heap::                                 ; start of our heap.
